<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Pensum Interactivo</title>
  <style>
    .semestre {
      margin-bottom: 20px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    .materia {
      margin: 6px 0;
      padding: 10px;
      cursor: pointer;
      border: 1px solid #ddd;
      border-radius: 4px;
      background-color: #f5f5f5;
    }
    .materia.tachada {
      text-decoration: line-through;
      color: green;
      background-color: #eaffea;
    }
    .materia.bloqueada {
      color: gray;
      background-color: #f0f0f0;
      cursor: not-allowed;
    }
    button {
      margin-top: 5px;
    }
  </style>
</head>
<body>

<h1>Pensum Interactivo</h1>
<button onclick="resetearProgreso()">Resetear progreso</button>
<div id="pensum"></div>

<script>
const materiasPorSemestre = [
  [
    {
      nombre: "Economía I",
      requisitos: [],
      creditos: 3,
      profesor: "Dra. Gómez",
      intentos: []
    },
    {
      nombre: "Historia Económica General",
      requisitos: [],
      creditos: 2,
      profesor: "Lic. Ríos",
      intentos: []
    },
    {
      nombre: "Matemáticas I",
      requisitos: [],
      creditos: 4,
      profesor: "Dr. Pérez",
      intentos: []
    }
  ],
  [
    {
      nombre: "Microeconomía I",
      requisitos: ["Economía I"],
      creditos: 3,
      profesor: "Dra. Castaño",
      intentos: []
    },
    {
      nombre: "Estadística I",
      requisitos: [],
      creditos: 3,
      profesor: "Ing. Díaz",
      intentos: []
    },
    {
      nombre: "Matemáticas II",
      requisitos: ["Matemáticas I"],
      creditos: 4,
      profesor: "Dr. Suárez",
      intentos: []
    }
  ],
  [
    {
      nombre: "Microeconomía II",
      requisitos: ["Microeconomía I"],
      creditos: 3,
      profesor: "Dra. Rivera",
      intentos: []
    },
    {
      nombre: "Econometría",
      requisitos: ["Estadística I"],
      creditos: 3,
      profesor: "Dra. Lozano",
      intentos: []
    },
    {
      nombre: "Matemáticas III",
      requisitos: ["Matemáticas II"],
      creditos: 4,
      profesor: "Dr. Lara",
      intentos: []
    }
  ]
];

// Cargar datos previos
const materiasGuardadas = JSON.parse(localStorage.getItem("estadoMaterias"));
if (materiasGuardadas) {
  materiasGuardadas.forEach((semestre, i) => {
    semestre.forEach((materia, j) => {
      materiasPorSemestre[i][j].intentos = materia.intentos || [];
      if (materia.profesor) materiasPorSemestre[i][j].profesor = materia.profesor;
      if (materia.creditos) materiasPorSemestre[i][j].creditos = materia.creditos;
    });
  });
}

// Cargar aprobadas
const aprobadas = new Set(JSON.parse(localStorage.getItem("aprobadas")) || []);

function estaDesbloqueada(materia) {
  return materia.requisitos.every(req => aprobadas.has(req));
}

function guardar() {
  localStorage.setItem('aprobadas', JSON.stringify([...aprobadas]));
  localStorage.setItem('estadoMaterias', JSON.stringify(materiasPorSemestre));
}

function mostrarFormulario(materia) {
  const nombre = prompt("¿Nombre del profesor?");
  const corte1 = parseFloat(prompt("Nota corte 1 (0-5):"));
  const corte2 = parseFloat(prompt("Nota corte 2 (0-5):"));
  const corte3 = parseFloat(prompt("Nota corte 3 (0-5):"));

  if (
    isNaN(corte1) || corte1 < 0 || corte1 > 5 ||
    isNaN(corte2) || corte2 < 0 || corte2 > 5 ||
    isNaN(corte3) || corte3 < 0 || corte3 > 5
  ) {
    alert("Las notas deben estar entre 0 y 5.");
    return;
  }

  const definitiva = ((corte1 + corte2 + corte3) / 3).toFixed(2);

  const intento = {
    profesor: nombre || materia.profesor,
    notas: [corte1, corte2, corte3],
    definitiva: parseFloat(definitiva)
  };

  materia.intentos.push(intento);

  if (intento.definitiva >= 3.0) {
    aprobadas.add(materia.nombre);
  }

  guardar();
  renderPensum();
}

function toggleMateria(nombre) {
  if (aprobadas.has(nombre)) {
    aprobadas.delete(nombre);
  } else {
    aprobadas.add(nombre);
  }
  guardar();
  renderPensum();
}

function resetearProgreso() {
  if (confirm("¿Estás seguro de que quieres borrar todo el progreso?")) {
    localStorage.removeItem("aprobadas");
    localStorage.removeItem("estadoMaterias");
    aprobadas.clear();
    materiasPorSemestre.forEach(semestre => {
      semestre.forEach(materia => materia.intentos = []);
    });
    renderPensum();
  }
}

function renderPensum() {
  const pensumDiv = document.getElementById('pensum');
  pensumDiv.innerHTML = '';

  materiasPorSemestre.forEach((semestre, idx) => {
    const contenedor = document.createElement('div');
    contenedor.className = 'semestre';
    contenedor.innerHTML = `<h3>Semestre ${idx + 1}</h3>`;

    semestre.forEach(materia => {
      const item = document.createElement('div');
      item.className = 'materia';
      item.innerHTML = `
        <strong>${materia.nombre}</strong><br>
        <small><b>Créditos:</b> ${materia.creditos} | <b>Profesor:</b> ${materia.profesor}</small><br>
        <small><b>Intentos:</b> ${materia.intentos.length}</small>
        <ul>
          ${materia.intentos.map(i => `
            <li>
              <b>Notas:</b> ${i.notas.join(', ')} |
              <b>Definitiva:</b> ${i.definitiva} |
              <b>Profesor:</b> ${i.profesor}
            </li>
          `).join('')}
        </ul>
      `;

      const botones = document.createElement('div');

      if (!estaDesbloqueada(materia)) {
        item.classList.add('bloqueada');
      } else {
        if (aprobadas.has(materia.nombre)) {
          item.classList.add('tachada');
        } else {
          item.onclick = () => toggleMateria(materia.nombre);
        }

        const btnIntento = document.createElement('button');
        btnIntento.textContent = 'Agregar intento';
        btnIntento.onclick = (e) => {
          e.stopPropagation();
          mostrarFormulario(materia);
        };
        botones.appendChild(btnIntento);
      }

      item.appendChild(botones);
      contenedor.appendChild(item);
    });

    pensumDiv.appendChild(contenedor);
  });
}

renderPensum();
</script>

</body>
</html>
